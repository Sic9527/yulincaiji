<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>采集列表</title>		
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/app.css">
		<style type="text/css">
			h4{font-weight: normal;color: #333;font-size: 1rem;padding-bottom: .325rem;}
			.mui-f-right{font-weight: normal;color: #555;}
		</style>
	</head>
	<body class="mui-plus mui-statusbar mui-statusbar-offset">
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">采集列表</h1>
		</header>
		<div class="mui-content">
			<!--<h5 class="mui-content-padded">人口信息盘查</h5>-->
			<ul id="record" class="mui-table-view mui-table-view-striped mui-table-view-condensed">
				
			</ul>
		</div>
	</body>	
	<script src="js/jquery.js" type="text/javascript"></script>
	<script src="js/main.js" type="text/javascript"></script>
	<script src="js/template-web.js" type="text/javascript"></script>
	<script src="js/common.js" type="text/javascript"></script>
    <script src="js/mui.min.js" type="text/javascript"></script>    
	<script src="js/applogin.js" type="text/javascript"></script>
	<script src="js/watermark.js" type="text/javascript"></script>
	<script id="recordOutline" type="text/html">
		{{each data record}}
			<li class="mui-table-view-cell">
				<a href="qu-table.html" recordId="{{record.ID}}">
					{{if record.tableName == 't_ga_xz_wifirdxx_wtk'}}
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.PK_VALUE}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_za_baxt_bafwxkz_wtk'}}					
						<h4 class="mui-ellipsis">{{record.ID}}</h4>
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.ID}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_za_baxt_bags_wtk'}}	
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.ID}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_xz_qqzhxx_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.PK_VALUE}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_xz_dddczhxx_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.PK_VALUE}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_jwb_bwryxx_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.YBZJ}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_za_baxt_wtryb_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.ID}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_jwb_dwxx_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.YBZJ}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_za_baxt_bafwgsxkssb_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.ID}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_za_baxt_baytxb_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.ID}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_za_baxt_bayzsb_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.ID}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_za_baxt_clxx_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.ID}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_jg_jdcbdcx_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.JL_YBZJ}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_wb_zsy_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.MC}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_wb_zsh_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.JYZMC}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_shbz_cbryjcxx_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.AAC001}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_shbz_rycbqkb_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.AAC001}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_xz_sjdxjl_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.PK_VALUE}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_za_baxt_bajtcyb_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.ID}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_zls_yhxx_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.MASID}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_za_czrk_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.RYBH}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_za_syrkzp_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.PERSON_ID}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_jg_jdcbddj_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.JL_YBZJ}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_zls_ylxx_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.MASID}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_zls_yhsjjfxx_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.PID}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_zls_hbyhxx_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.MAMID}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_gy_question_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.ID}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_zfjd_xyrb_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.S_ID}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_zfjd_jqyj_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.S_ID}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_qb_zdrxx_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.ZDRYBH}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_xz_ztryxx_wtk'}}					
						{{if record.NAME == ''}}
							<h4 class="mui-ellipsis">{{record.YBZJ}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.NAME}}</h4> 
						{{/if}}
					{{else if record.tableName == 't_ga_jg_jdcdjxx_wtk'}}					
						{{if record.SYR == ''}}
							<h4 class="mui-ellipsis">{{record.XH}}</h4>
						{{else }}
							<h4 class="mui-ellipsis">{{record.SYR}}</h4> 
						{{/if}}
					{{else}}
						<h4 class="mui-ellipsis">*<span class="mui-f-right"></span></h4>
					{{/if}}
				</a>
				
			</li>
		{{/each}}
	</script>
    <script type="text/javascript">
		window.addEventListener('refresh', function(e){//执行刷新
			location.reload();
		});
		var self;
		mui.plusReady(function(){
			self = plus.webview.currentWebview();
			var tableName = self.tableName;//获得tableName
			var tableId = self.tableId;
			var tableComment = self.tableComment;
			console.log(tableName + "------" + tableComment);
			var recordIds = self.recordIds;//获得recordIds
			console.log("--recordIds--"+recordIds);
			var mpId = self.mpId;//获取messagePushId
			console.log("mpId"+mpId);
			var data = {tableId:tableId,tableName:tableName,recordIds:recordIds};
			//加载推送表记录信息
			mui.ajax(base_url+'/base/gainRecordOutline', {
				dataType:'json',//服务器返回json格式数据
				data:data,//携带数据
				type:'get',//HTTP请求类型
				timeout:100000,//超时时间设置为10秒
				headers:{
					'Content-Type':'application/x-www-form-urlencoded' //此处如果使用application/json 会遇到post发送参数失败的问题
					,'user_id_token':app.getUser().userid	
					,'urlName':"采集列表"
				},
				success: function(result) {
					console.log(JSON.stringify(result));
					//如果表完成,则返回到推送消息列表
					if (result.data.length == 0) {
						mui.back();
					}
					if(result.code=='200'){						
						result.data.forEach(function(item,index){
							result.data[index].tableName = tableName;
						});
						var html = template('recordOutline', result);
	//					console.log(html);
						console.log(JSON.stringify(result));
						$('#record').html(html);
						//主列表点击事件
						mui('.mui-content').on('tap', 'a', function() {
							var href = this.getAttribute('href');
							
							//非plus环境，直接走href跳转
							if(!mui.os.plus) {
								location.href = href;
								return;
							}
							//打开新窗口
							var id = this.getAttribute("data-wid");
							if(!id) {
								id = href;
							}
					
							if(href && ~href.indexOf('.html')) {
								//打开窗口的相关参数
								var options = {
									styles:{
										popGesture: "close"
									},
									extras:{
										"tableId":tableId,
										"tableName":tableName,
										"tableComment":tableComment,
										"recordId":this.getAttribute('recordId'),
										"pagesour":'push',
										"mpId":mpId
									}
								};
								mui.openWindow(href,id,options);
							}
						});
					}else{
						
					}
				},
				error: function(xhr,type,errorThrown) {
					console.log(type);
				}
			});
		});
    </script>
</html>
